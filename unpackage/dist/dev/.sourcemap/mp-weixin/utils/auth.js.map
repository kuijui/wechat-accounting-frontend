{"version":3,"file":"auth.js","sources":["utils/auth.ts"],"sourcesContent":["import type { LoginResponse, UserInfo } from '../types';\r\n\r\n// Token 相关操作\r\nexport const getToken = (): string | null => {\r\n  try {\r\n    return uni.getStorageSync('token') || null;\r\n  } catch (error) {\r\n    console.error('Get token error:', error);\r\n    return null;\r\n  }\r\n};\r\n\r\nexport const setToken = (token: string): void => {\r\n  try {\r\n    uni.setStorageSync('token', token);\r\n  } catch (error) {\r\n    console.error('Set token error:', error);\r\n  }\r\n};\r\n\r\nexport const removeToken = (): void => {\r\n  try {\r\n    uni.removeStorageSync('token');\r\n  } catch (error) {\r\n    console.error('Remove token error:', error);\r\n  }\r\n};\r\n\r\n// 用户信息相关操作\r\nexport const getUserInfo = (): UserInfo | null => {\r\n  try {\r\n    const userInfoStr = uni.getStorageSync('userInfo');\r\n    return userInfoStr ? JSON.parse(userInfoStr) : null;\r\n  } catch (error) {\r\n    console.error('Get user info error:', error);\r\n    return null;\r\n  }\r\n};\r\n\r\nexport const setUserInfo = (userInfo: UserInfo): void => {\r\n  try {\r\n    uni.setStorageSync('userInfo', JSON.stringify(userInfo));\r\n  } catch (error) {\r\n    console.error('Set user info error:', error);\r\n  }\r\n};\r\n\r\nexport const removeUserInfo = (): void => {\r\n  try {\r\n    uni.removeStorageSync('userInfo');\r\n  } catch (error) {\r\n    console.error('Remove user info error:', error);\r\n  }\r\n};\r\n\r\n// 登录状态检查\r\nexport const isLoggedIn = (): boolean => {\r\n  const token = getToken();\r\n  const userInfo = getUserInfo();\r\n  return !!(token && userInfo);\r\n};\r\n\r\n// 登录成功后保存信息\r\nexport const saveLoginInfo = (loginResponse: LoginResponse): void => {\r\n  const { token, userId, nickname, avatarUrl } = loginResponse;\r\n  \r\n  // 保存 token\r\n  setToken(token);\r\n  \r\n  // 保存用户信息\r\n  setUserInfo({\r\n    id: userId,\r\n    nickname,\r\n    avatarUrl\r\n  });\r\n};\r\n\r\n// 退出登录\r\nexport const logout = (): void => {\r\n  removeToken();\r\n  removeUserInfo();\r\n  \r\n  // 跳转到登录页\r\n  uni.reLaunch({\r\n    url: '/pages/login/login'\r\n  });\r\n};\r\n\r\n// 检查登录状态，未登录则跳转登录页\r\nexport const checkAuth = (): boolean => {\r\n  if (!isLoggedIn()) {\r\n    uni.reLaunch({\r\n      url: '/pages/login/login'\r\n    });\r\n    return false;\r\n  }\r\n  return true;\r\n};\r\n\r\n// 获取微信登录码\r\nexport const getWechatLoginCode = (): Promise<string> => {\r\n  return new Promise((resolve, reject) => {\r\n    uni.login({\r\n      provider: 'weixin',\r\n      success: (res) => {\r\n        if (res.code) {\r\n          resolve(res.code);\r\n        } else {\r\n          reject(new Error('获取登录码失败'));\r\n        }\r\n      },\r\n      fail: (error) => {\r\n        reject(new Error('微信登录失败: ' + (error.errMsg || '未知错误')));\r\n      }\r\n    });\r\n  });\r\n};\r\n"],"names":["uni"],"mappings":";;AAGO,MAAM,WAAW,MAAqB;AACvC,MAAA;AACK,WAAAA,oBAAI,eAAe,OAAO,KAAK;AAAA,WAC/B,OAAO;AACdA,kBAAA,MAAA,MAAA,SAAA,sBAAc,oBAAoB,KAAK;AAChC,WAAA;AAAA,EACT;AACF;AAEa,MAAA,WAAW,CAAC,UAAwB;AAC3C,MAAA;AACEA,kBAAAA,MAAA,eAAe,SAAS,KAAK;AAAA,WAC1B,OAAO;AACdA,kBAAA,MAAA,MAAA,SAAA,uBAAc,oBAAoB,KAAK;AAAA,EACzC;AACF;AAWO,MAAM,cAAc,MAAuB;AAC5C,MAAA;AACI,UAAA,cAAcA,cAAAA,MAAI,eAAe,UAAU;AACjD,WAAO,cAAc,KAAK,MAAM,WAAW,IAAI;AAAA,WACxC,OAAO;AACdA,kBAAA,MAAA,MAAA,SAAA,uBAAc,wBAAwB,KAAK;AACpC,WAAA;AAAA,EACT;AACF;AAEa,MAAA,cAAc,CAAC,aAA6B;AACnD,MAAA;AACFA,kBAAA,MAAI,eAAe,YAAY,KAAK,UAAU,QAAQ,CAAC;AAAA,WAChD,OAAO;AACdA,kBAAA,MAAA,MAAA,SAAA,uBAAc,wBAAwB,KAAK;AAAA,EAC7C;AACF;AAWO,MAAM,aAAa,MAAe;AACvC,QAAM,QAAQ;AACd,QAAM,WAAW;AACV,SAAA,CAAC,EAAE,SAAS;AACrB;AAGa,MAAA,gBAAgB,CAAC,kBAAuC;AACnE,QAAM,EAAE,OAAO,QAAQ,UAAU,cAAc;AAG/C,WAAS,KAAK;AAGF,cAAA;AAAA,IACV,IAAI;AAAA,IACJ;AAAA,IACA;AAAA,EAAA,CACD;AACH;AAcO,MAAM,YAAY,MAAe;AAClC,MAAA,CAAC,cAAc;AACjBA,kBAAAA,MAAI,SAAS;AAAA,MACX,KAAK;AAAA,IAAA,CACN;AACM,WAAA;AAAA,EACT;AACO,SAAA;AACT;AAGO,MAAM,qBAAqB,MAAuB;AACvD,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtCA,kBAAAA,MAAI,MAAM;AAAA,MACR,UAAU;AAAA,MACV,SAAS,CAAC,QAAQ;AAChB,YAAI,IAAI,MAAM;AACZ,kBAAQ,IAAI,IAAI;AAAA,QAAA,OACX;AACE,iBAAA,IAAI,MAAM,SAAS,CAAC;AAAA,QAC7B;AAAA,MACF;AAAA,MACA,MAAM,CAAC,UAAU;AACf,eAAO,IAAI,MAAM,cAAc,MAAM,UAAU,OAAO,CAAC;AAAA,MACzD;AAAA,IAAA,CACD;AAAA,EAAA,CACF;AACH;;;;;"}