{"version":3,"file":"request.js","sources":["utils/request.ts"],"sourcesContent":["import { getToken } from './auth';\r\nimport type { ApiResponse } from '../types';\r\n\r\n// 基础配置\r\nconst BASE_URL = 'http://localhost:8081/api';\r\nconst TIMEOUT = 10000;\r\n\r\n// 请求配置接口\r\ninterface RequestConfig {\r\n  url: string;\r\n  method?: 'GET' | 'POST' | 'PUT' | 'DELETE';\r\n  data?: any;\r\n  header?: Record<string, string>;\r\n  timeout?: number;\r\n}\r\n\r\n// 请求封装\r\nclass Request {\r\n  private baseURL: string;\r\n  private timeout: number;\r\n\r\n  constructor(baseURL: string = BASE_URL, timeout: number = TIMEOUT) {\r\n    this.baseURL = baseURL;\r\n    this.timeout = timeout;\r\n  }\r\n\r\n  // 通用请求方法\r\n  private async request<T = any>(config: RequestConfig): Promise<ApiResponse<T>> {\r\n    const { url, method = 'GET', data, header = {}, timeout = this.timeout } = config;\r\n    \r\n    // 添加认证头\r\n    const token = getToken();\r\n    if (token) {\r\n      header['Authorization'] = `Bearer ${token}`;\r\n    }\r\n    \r\n    // 添加默认头\r\n    header['Content-Type'] = header['Content-Type'] || 'application/json';\r\n    \r\n    try {\r\n      const response = await uni.request({\r\n        url: this.baseURL + url,\r\n        method,\r\n        data,\r\n        header,\r\n        timeout\r\n      });\r\n      \r\n      const { statusCode, data: responseData } = response;\r\n      \r\n      // HTTP 状态码检查\r\n      if (statusCode !== 200) {\r\n        throw new Error(`HTTP Error: ${statusCode}`);\r\n      }\r\n      \r\n      // 业务状态码检查\r\n      if (responseData.code !== 200) {\r\n        // 如果是认证失败，清除 token 并跳转登录\r\n        if (responseData.code === 401) {\r\n          uni.removeStorageSync('token');\r\n          uni.reLaunch({\r\n            url: '/pages/login/login'\r\n          });\r\n        }\r\n        throw new Error(responseData.message || '请求失败');\r\n      }\r\n      \r\n      return responseData;\r\n    } catch (error: any) {\r\n      console.error('Request Error:', error);\r\n      \r\n      // 网络错误处理\r\n      if (error.errMsg) {\r\n        if (error.errMsg.includes('timeout')) {\r\n          throw new Error('请求超时，请检查网络连接');\r\n        } else if (error.errMsg.includes('fail')) {\r\n          throw new Error('网络连接失败，请检查网络设置');\r\n        }\r\n      }\r\n      \r\n      throw error;\r\n    }\r\n  }\r\n  \r\n  // GET 请求\r\n  get<T = any>(url: string, params?: any): Promise<ApiResponse<T>> {\r\n    let queryString = '';\r\n    if (params) {\r\n      const queryParams = Object.keys(params)\r\n        .filter(key => params[key] !== undefined && params[key] !== null)\r\n        .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`)\r\n        .join('&');\r\n      if (queryParams) {\r\n        queryString = `?${queryParams}`;\r\n      }\r\n    }\r\n    \r\n    return this.request<T>({\r\n      url: url + queryString,\r\n      method: 'GET'\r\n    });\r\n  }\r\n  \r\n  // POST 请求\r\n  post<T = any>(url: string, data?: any): Promise<ApiResponse<T>> {\r\n    return this.request<T>({\r\n      url,\r\n      method: 'POST',\r\n      data\r\n    });\r\n  }\r\n  \r\n  // PUT 请求\r\n  put<T = any>(url: string, data?: any): Promise<ApiResponse<T>> {\r\n    return this.request<T>({\r\n      url,\r\n      method: 'PUT',\r\n      data\r\n    });\r\n  }\r\n  \r\n  // DELETE 请求\r\n  delete<T = any>(url: string): Promise<ApiResponse<T>> {\r\n    return this.request<T>({\r\n      url,\r\n      method: 'DELETE'\r\n    });\r\n  }\r\n}\r\n\r\n// 创建实例\r\nconst request = new Request();\r\n\r\nexport default request;\r\n"],"names":["getToken","uni"],"mappings":";;;;;;;;;AAIA,MAAM,WAAW;AACjB,MAAM,UAAU;AAYhB,MAAM,QAAQ;AAAA,EAIZ,YAAY,UAAkB,UAAU,UAAkB,SAAS;AAH3D;AACA;AAGN,SAAK,UAAU;AACf,SAAK,UAAU;AAAA,EACjB;AAAA;AAAA,EAGA,MAAc,QAAiB,QAAgD;AACvE,UAAA,EAAE,KAAK,SAAS,OAAO,MAAM,SAAS,CAAI,GAAA,UAAU,KAAK,QAAA,IAAY;AAG3E,UAAM,QAAQA,WAAAA;AACd,QAAI,OAAO;AACF,aAAA,eAAe,IAAI,UAAU,KAAK;AAAA,IAC3C;AAGA,WAAO,cAAc,IAAI,OAAO,cAAc,KAAK;AAE/C,QAAA;AACI,YAAA,WAAW,MAAMC,cAAA,MAAI,QAAQ;AAAA,QACjC,KAAK,KAAK,UAAU;AAAA,QACpB;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MAAA,CACD;AAED,YAAM,EAAE,YAAY,MAAM,aAAA,IAAiB;AAG3C,UAAI,eAAe,KAAK;AACtB,cAAM,IAAI,MAAM,eAAe,UAAU,EAAE;AAAA,MAC7C;AAGI,UAAA,aAAa,SAAS,KAAK;AAEzB,YAAA,aAAa,SAAS,KAAK;AAC7BA,8BAAI,kBAAkB,OAAO;AAC7BA,wBAAAA,MAAI,SAAS;AAAA,YACX,KAAK;AAAA,UAAA,CACN;AAAA,QACH;AACA,cAAM,IAAI,MAAM,aAAa,WAAW,MAAM;AAAA,MAChD;AAEO,aAAA;AAAA,aACA,OAAY;AACnBA,oBAAA,MAAA,MAAA,SAAA,0BAAc,kBAAkB,KAAK;AAGrC,UAAI,MAAM,QAAQ;AAChB,YAAI,MAAM,OAAO,SAAS,SAAS,GAAG;AAC9B,gBAAA,IAAI,MAAM,cAAc;AAAA,QACrB,WAAA,MAAM,OAAO,SAAS,MAAM,GAAG;AAClC,gBAAA,IAAI,MAAM,gBAAgB;AAAA,QAClC;AAAA,MACF;AAEM,YAAA;AAAA,IACR;AAAA,EACF;AAAA;AAAA,EAGA,IAAa,KAAa,QAAuC;AAC/D,QAAI,cAAc;AAClB,QAAI,QAAQ;AACV,YAAM,cAAc,OAAO,KAAK,MAAM,EACnC,OAAO,CAAO,QAAA,OAAO,GAAG,MAAM,UAAa,OAAO,GAAG,MAAM,IAAI,EAC/D,IAAI,CAAO,QAAA,GAAG,mBAAmB,GAAG,CAAC,IAAI,mBAAmB,OAAO,GAAG,CAAC,CAAC,EAAE,EAC1E,KAAK,GAAG;AACX,UAAI,aAAa;AACf,sBAAc,IAAI,WAAW;AAAA,MAC/B;AAAA,IACF;AAEA,WAAO,KAAK,QAAW;AAAA,MACrB,KAAK,MAAM;AAAA,MACX,QAAQ;AAAA,IAAA,CACT;AAAA,EACH;AAAA;AAAA,EAGA,KAAc,KAAa,MAAqC;AAC9D,WAAO,KAAK,QAAW;AAAA,MACrB;AAAA,MACA,QAAQ;AAAA,MACR;AAAA,IAAA,CACD;AAAA,EACH;AAAA;AAAA,EAGA,IAAa,KAAa,MAAqC;AAC7D,WAAO,KAAK,QAAW;AAAA,MACrB;AAAA,MACA,QAAQ;AAAA,MACR;AAAA,IAAA,CACD;AAAA,EACH;AAAA;AAAA,EAGA,OAAgB,KAAsC;AACpD,WAAO,KAAK,QAAW;AAAA,MACrB;AAAA,MACA,QAAQ;AAAA,IAAA,CACT;AAAA,EACH;AACF;AAGM,MAAA,UAAU,IAAI,QAAQ;;"}